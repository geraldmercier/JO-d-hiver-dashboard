<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•á Dashboard Agent ‚Äî JO d'Hiver</title>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="dashboard-body">

    <header class="dashboard-header">
        <div class="header-container">
            <div class="header-logo">
                <img src="assets/olympic.png" alt="Logo" class="logo-icon-img">
                <div class="logo-text">
                    <h1>JO d'Hiver 2026</h1>
                    <p>Challenge Commercial</p>
                </div>
            </div>

            <div class="header-profil">
                <div class="profil-avatar">
                    <img src="" alt="Avatar" id="avatar-agent">
                    <span class="profil-drapeau" id="drapeau-equipe"></span>
                </div>
                <div class="profil-info">
                    <h2 class="profil-nom" id="nom-agent">Chargement...</h2>
                    <p class="profil-equipe" id="nom-equipe">...</p>
                </div>
                <div class="profil-score">
                    <div class="score-valeur" id="score-total">0</div>
                    <div class="score-label">points</div>
                </div>
                <div class="header-actions">
                    <button class="btn-deconnexion" id="btn-deconnexion">üö™ D√©connexion</button>
                </div>
            </div>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="dashboard-container">

            <div class="colonne-gauche">

                <section class="carte carte-position">
                    <h3 class="carte-titre">üìä Votre Position</h3>
                    <div class="position-grid">
                        <div class="position-item">
                            <div class="position-label">Global</div>
                            <div class="position-valeur" id="rang-global">-</div>
                        </div>
                        <div class="position-item">
                            <div class="position-label">√âquipe</div>
                            <div class="position-valeur" id="rang-equipe">-</div>
                        </div>
                    </div>
                    <div id="points-manquants" class="points-manquants">Calcul en cours...</div>
                </section>

                <section class="carte carte-podium">
                    <h3 class="carte-titre">üèÜ Podium du Jour</h3>
                    <div class="podium-container">
                        <div class="podium-step step-2">
                            <div class="podium-avatar" id="podium-jour-2-avatar">üë§</div>
                            <div class="podium-barre">2</div>
                            <div class="podium-info">
                                <span id="podium-jour-2-nom">-</span>
                                <small id="podium-jour-2-score">0 pts</small>
                            </div>
                        </div>
                        <div class="podium-step step-1">
                            <div class="podium-icon">ü•á</div>
                            <div class="podium-avatar" id="podium-jour-1-avatar">üë§</div>
                            <div class="podium-barre">1</div>
                            <div class="podium-info">
                                <span id="podium-jour-1-nom">-</span>
                                <small id="podium-jour-1-score">0 pts</small>
                            </div>
                        </div>
                        <div class="podium-step step-3">
                            <div class="podium-avatar" id="podium-jour-3-avatar">üë§</div>
                            <div class="podium-barre">3</div>
                            <div class="podium-info">
                                <span id="podium-jour-3-nom">-</span>
                                <small id="podium-jour-3-score">0 pts</small>
                            </div>
                        </div>
                    </div>
                    <p id="podium-encouragement" class="podium-message">Accrochez-vous !</p>
                </section>

               <section class="carte carte-fil-rouge" style="margin-top:20px;">
    <h3 class="carte-titre">üìà Fil Rouge - Objectif √âquipe</h3>
    <div style="height: 300px; position: relative;">
        <canvas id="graphiqueFilRouge"></canvas>
    </div>
</section>

                <section class="carte carte-performance-jour">
                    <h3 class="carte-titre">üéØ Aujourd'hui</h3>
                    <div class="epreuve-info">
                        <div class="epreuve-date" id="date-epreuve">...</div>
                    </div>
                    <div class="performance-grid">
                        <div class="perf-item">
                            <div class="perf-label">Score Jour</div>
                            <div class="perf-valeur score-actuel" id="score-jour">0 pts</div>
                        </div>
                        <div class="perf-item">
                            <div class="perf-label">Classement</div>
                            <div class="perf-valeur" id="classement-jour">-</div>
                        </div>
                    </div>
                </section>

                <section class="carte carte-equipe">
                    <h3 class="carte-titre">üö© Votre √âquipe</h3>
                    <div class="equipe-classement">
                        <div class="equipe-score" id="score-equipe">0 pts</div>
                    </div>
                    <div class="equipe-top3">
                        <h4>üèÜ Top 3 √âquipe</h4>
                        <ul class="top3-liste" id="top3-equipe">
                            </ul>
                    </div>
                </section>

            </div>

            <div class="colonne-droite">

                <section class="carte carte-formulaire">
                    <h3 class="carte-titre">‚úÖ Enregistrer un Contrat</h3>
                    <form id="formulaire-contrat" class="form-contrat">
                        <div class="form-groupe">
                            <label>Type de contrat</label>
                            <select id="type-contrat" required>
                                <option value="">-- S√©lectionnez --</option>
                                <option value="Telco">Telco (Movers S1)</option>
                                <option value="Mobile">Mobile (Switchers S1)</option>
                                <option value="MRH">MRH (Movers S2)</option>
                                <option value="Compensation Carbone">Compensation Carbone</option>
                                <option value="Premium">Premium (Coachs)</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-groupe">
                            <label>Lien Salesforce</label>
                            <input type="url" id="lien-piste" placeholder="https://..." required>
                        </div>
                        <div class="form-groupe checkbox-groupe">
                            <label class="checkbox-label">
                                <input type="checkbox" id="contrat-apiapp">
                                <span class="checkbox-text">üì± Contrat ApiApp</span>
                            </label>
                        </div>
                        <button type="submit" class="btn-enregistrer" id="btn-enregistrer">
                            <span id="btn-texte">‚úÖ Enregistrer</span>
                        </button>
                    </form>
                </section>

                <section class="carte carte-badges">
                    <h3 class="carte-titre">üèÖ Vos Troph√©es</h3>
                    <div id="badges-grid" class="badges-grid">
                        </div>
                </section>

                <section class="carte carte-contrats-jour">
                    <h3 class="carte-titre">üìù Vos Contrats du Jour</h3>
                    <div class="contrats-liste" id="contrats-liste">
                        <div class="chargement">Chargement...</div>
                    </div>
                </section>

                <section class="carte carte-calendrier">
                    <h3 class="carte-titre">üìÖ Calendrier Olympique</h3>
                    <div id="calendrier-grid" class="calendrier-grid">
                        </div>
                </section>

                <section class="carte">
                    <div class="section-header">
                        <h3 class="carte-titre">‚ö° Challenges Flash</h3>
                        <span class="badge-info" id="badge-challenges-actifs" style="display:none">0</span>
                    </div>
                    <div id="challenges-container" class="challenges-container">
                        <div class="chargement">Recherche de challenges...</div>
                    </div>
                </section>

            </div>
        </div>
    </main>

    <style>
        /* Challenges */
        .challenges-container { display: flex; flex-direction: column; gap: 15px; margin-top: 15px; }
        .challenge-card { background: linear-gradient(135deg, #FFB300 0%, #FF6F00 100%); color: white; padding: 15px; border-radius: 10px; position: relative; }
        .challenge-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .challenge-titre { font-weight: bold; font-size: 1.1em; margin: 0; }
        .challenge-points { background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 10px; font-weight: bold; }
        .challenge-description { font-size: 0.9em; opacity: 0.9; margin-bottom: 10px; }
        .challenge-barre { background: rgba(0,0,0,0.2); height: 8px; border-radius: 4px; overflow: hidden; }
        .challenge-barre-remplie { background: white; height: 100%; }
        .aucun-challenge { text-align: center; color: #aaa; font-style: italic; padding: 20px; }

        /* Podium */
        .podium-container { display: flex; align-items: flex-end; justify-content: center; height: 160px; margin-bottom: 15px; gap: 8px; }
        .podium-step { display: flex; flex-direction: column; align-items: center; text-align: center; width: 33%; }
        .podium-barre { width: 100%; border-radius: 5px 5px 0 0; color: white; font-weight: bold; display: flex; align-items: center; justify-content: center; margin-top: 5px; }
        .step-1 .podium-barre { height: 80px; background: #FFD700; font-size: 1.2em; box-shadow: 0 4px 10px rgba(255, 215, 0, 0.4); }
        .step-2 .podium-barre { height: 60px; background: #C0C0C0; }
        .step-3 .podium-barre { height: 40px; background: #CD7F32; }
        .podium-avatar { font-size: 20px; background: #f0f2f5; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .podium-info { margin-top: 5px; font-size: 0.8em; line-height: 1.2; display: flex; flex-direction: column; }
        .podium-info span { font-weight: bold; color: #333; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px; }
        .podium-message { text-align: center; font-style: italic; color: #666; font-size: 0.9em; margin-top: 10px; }

        /* Calendrier */
        .calendrier-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
        .jour-carte { background: #f8f9fa; padding: 8px 4px; border-radius: 6px; text-align: center; font-size: 0.8em; border: 1px solid #eee; position: relative; }
        .jour-actuel { border: 2px solid #1976D2; background: #e3f2fd; font-weight: bold; }
        .jour-futur { opacity: 0.5; }
        .jour-score { font-weight: bold; color: #1976D2; margin-top: 4px; }
        .jour-medaille { position: absolute; top: -5px; right: -5px; font-size: 14px; }

        /* Badges */
        .badges-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 10px; margin-top: 10px; }
        .badge-carte { background: #f5f5f5; border-radius: 8px; padding: 10px 5px; text-align: center; transition: transform 0.2s; }
        .badge-carte:hover { transform: scale(1.05); }
        .badge-deblocque { background: #fff8e1; border: 1px solid #ffecb3; }
        .badge-verrouille { opacity: 0.6; filter: grayscale(1); }
        .badge-icone { font-size: 24px; margin-bottom: 5px; }
        .badge-nom { font-size: 0.75em; color: #555; line-height: 1.2; }
        
        /* Petits ajustements */
        .points-manquants { text-align: center; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic; }
        .top3-liste { padding-left: 0; list-style: none; }
        .top3-liste li { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee; font-size: 0.9em; }
        .top3-liste li.vous { font-weight: bold; color: #1976D2; background: #e3f2fd; padding-left: 5px; padding-right: 5px; border-radius: 4px; }
    </style>


    <script src="config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="dashboard.js"></script>

    <div id="modal-challenge" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn" onclick="fermerModal()">&times;</span>
        
        <h2 id="modal-titre" style="color: #002395;">Titre du Challenge</h2>
        <hr>
        
        <p id="modal-desc" style="font-size: 1.1em; margin: 15px 0;">Description du challenge...</p>
        
        <div id="modal-gains" style="background: #f4f6f8; padding: 10px; border-radius: 8px;">
            </div>

        <button onclick="fermerModal()" style="margin-top: 15px; width: 100%; padding: 10px; background: #002395; color: white; border: none; border-radius: 5px; cursor: pointer;">Compris !</button>
    </div>
</div>

<div id="popup-nouveau-challenge" class="modal" style="display:none; align-items:center; justify-content:center; z-index:9999;">
    <div class="modal-content" style="border-top: 5px solid #2196F3; text-align:center; position:relative;">
        <span onclick="fermerPopup('popup-nouveau-challenge')" style="position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; font-weight:bold;">&times;</span>
        <div style="font-size: 50px;">‚ö°</div>
        <h2 style="color: #1565C0; margin: 10px 0;">Nouveau Challenge !</h2>
        <h3 id="popup-titre-challenge" style="color: #333;">...</h3>
        <p id="popup-desc-challenge" style="color: #666; margin: 15px 0;">...</p>
        <div style="background:#e3f2fd; padding:10px; border-radius:8px; display:inline-block; font-weight:bold; color:#1565C0;">
            Gains : <span id="popup-points-challenge"></span> pts
        </div>
        <br><br>
        <button onclick="fermerPopup('popup-nouveau-challenge')" style="background:#2196F3; color:white; border:none; padding:10px 30px; border-radius:20px; font-weight:bold; cursor:pointer;">C'est parti !</button>
    </div>
</div>

<div id="popup-victoire" class="modal" style="display:none; align-items:center; justify-content:center; z-index:9999;">
    <div class="modal-content" style="border-top: 5px solid #FFD700; text-align:center; position:relative; background:linear-gradient(to bottom, #fff, #fffde7);">
        <span onclick="fermerPopup('popup-victoire')" style="position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; font-weight:bold;">&times;</span>
        <div style="font-size: 50px;">üèÜ</div>
        <h2 style="color: #FBC02D; margin: 10px 0;">Challenge Remport√© !</h2>
        <p style="font-size:1.1em; margin-bottom:20px;">
            Le d√©fi a √©t√© gagn√© par :<br>
            <strong id="popup-gagnant-nom" style="font-size:1.4em; color:#333;">...</strong>
        </p>
        <button onclick="fermerPopup('popup-victoire')" style="background:#FBC02D; color:white; border:none; padding:10px 30px; border-radius:20px; font-weight:bold; cursor:pointer;">Bravo !</button>
    </div>
</div>

<script>
    function fermerPopup(id) {
        document.getElementById(id).style.display = 'none';
    }
</script>
<div id="popup-nouveau-challenge" class="modal" style="display:none; align-items:center; justify-content:center; z-index:9999;">
    <div class="modal-content" style="border-top: 5px solid #2196F3; text-align:center; position:relative;">
        <span onclick="fermerPopup('popup-nouveau-challenge')" style="position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; font-weight:bold;">&times;</span>
        <div style="font-size: 50px;">‚ö°</div>
        <h2 style="color: #1565C0; margin: 10px 0;">Nouveau Challenge !</h2>
        <h3 id="popup-titre-challenge" style="color: #333;">...</h3>
        <p id="popup-desc-challenge" style="color: #666; margin: 15px 0;">...</p>
        <div style="background:#e3f2fd; padding:10px; border-radius:8px; display:inline-block; font-weight:bold; color:#1565C0;">
            Gains : <span id="popup-points-challenge"></span> pts
        </div>
        <br><br>
        <button onclick="fermerPopup('popup-nouveau-challenge')" style="background:#2196F3; color:white; border:none; padding:10px 30px; border-radius:20px; font-weight:bold; cursor:pointer;">C'est parti !</button>
    </div>
</div>

<div id="popup-victoire" class="modal" style="display:none; align-items:center; justify-content:center; z-index:9999;">
    <div class="modal-content" style="border-top: 5px solid #FFD700; text-align:center; position:relative; background:linear-gradient(to bottom, #fff, #fffde7);">
        <span onclick="fermerPopup('popup-victoire')" style="position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; font-weight:bold;">&times;</span>
        <div style="font-size: 50px;">üèÜ</div>
        <h2 style="color: #FBC02D; margin: 10px 0;">Challenge Remport√© !</h2>
        <p style="font-size:1.1em; margin-bottom:20px;">
            Le d√©fi a √©t√© gagn√© par :<br>
            <strong id="popup-gagnant-nom" style="font-size:1.4em; color:#333;">...</strong>
        </p>
        <button onclick="fermerPopup('popup-victoire')" style="background:#FBC02D; color:white; border:none; padding:10px 30px; border-radius:20px; font-weight:bold; cursor:pointer;">Bravo !</button>
    </div>
</div>

<script>
    function fermerPopup(id) {
        document.getElementById(id).style.display = 'none';
    }
</script>
</body>
</html>